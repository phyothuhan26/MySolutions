@startuml
title YPS Side: Retry & Uploading File Server
hide footbox
actor "YPS Client / Job" as YPS
participant "G&G API" as API
database "failure_list" as FAIL
participant "Scheduler (EOD)" as SCH
participant "File Server" as FS
participant "Email Service (SMTP)" as MAIL

== Transaction call ==
YPS -> API: Call operation (timeout=15s)
activate API

alt Success
  API --> YPS: Success response
else Timeout / failure
  API --> YPS: Failure / timeout

  loop Retry (max 4 times, delay 5 minutes)
    YPS -> API: Retry operation
    API --> YPS: Success or Failure
  end

  alt Still failed after max retries
    YPS -> FAIL: Insert failed transaction\n(as JSON payload)
    FAIL --> YPS: Saved
  end
end
deactivate API

== End of Day ==
SCH -> FAIL: Fetch all failed records for today
FAIL --> SCH: Failed record list

SCH -> SCH: Generate Excel file
SCH -> FS: Upload Excel file to file server
FS --> SCH: Upload success

SCH -> MAIL: Send email with file link/path\n(or attach Excel if required)
MAIL --> SCH: Email sent
@enduml
